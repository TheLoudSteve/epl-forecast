{
  "name": "EPLF",
  "description": "EPL Forecast monitoring - API calls, business metrics, and system performance",
  "permissions": "PUBLIC_READ_WRITE",
  "variables": [
    {
      "name": "timeWindow",
      "title": "Time Window",
      "type": "enum",
      "defaultValues": [
        {
          "value": {
            "string": "1 day ago"
          }
        }
      ],
      "items": [
        {
          "title": "Last 6 Hours",
          "value": "6 hours ago"
        },
        {
          "title": "Last 12 Hours",
          "value": "12 hours ago"
        },
        {
          "title": "Last 24 Hours",
          "value": "1 day ago"
        },
        {
          "title": "Last 48 Hours",
          "value": "2 days ago"
        },
        {
          "title": "Last 7 Days",
          "value": "7 days ago"
        },
        {
          "title": "Last 30 Days",
          "value": "30 days ago"
        }
      ],
      "isMultiSelection": false,
      "nrqlQuery": null,
      "replacementStrategy": "string"
    }
  ],
  "pages": [
    {
      "name": "Football API Overview",
      "description": "Overview of API calls, response times, and status codes",
      "widgets": [
        {
          "title": "Total API Calls (24h)",
          "layout": {
            "column": 1,
            "row": 1,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM Metric SELECT sum(aws.eplforecast.footballapi.APICallCount) AS 'Total Calls' WHERE collector.name = 'cloudwatch-metric-streams' SINCE {{timeWindow}}"
              }
            ],
            "thresholds": []
          }
        },
        {
          "title": "Average Response Time (1h)",
          "layout": {
            "column": 5,
            "row": 1,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM Metric SELECT average(aws.eplforecast.footballapi.APIResponseTime) AS 'Avg Response Time (ms)' WHERE collector.name = 'cloudwatch-metric-streams' SINCE {{timeWindow}}"
              }
            ],
            "thresholds": [
              {
                "alertSeverity": "WARNING",
                "value": 1000
              },
              {
                "alertSeverity": "CRITICAL",
                "value": 2000
              }
            ]
          }
        },
        {
          "title": "API Calls by Environment",
          "layout": {
            "column": 9,
            "row": 1,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.pie"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM Metric SELECT sum(aws.eplforecast.footballapi.APICallCount) WHERE collector.name = 'cloudwatch-metric-streams' FACET aws.eplforecast.footballapi.Environment SINCE {{timeWindow}}"
              }
            ]
          }
        },
        {
          "title": "API Calls Over Time",
          "layout": {
            "column": 1,
            "row": 4,
            "width": 8,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM Metric SELECT sum(aws.eplforecast.footballapi.APICallCount) WHERE collector.name = 'cloudwatch-metric-streams' FACET aws.eplforecast.footballapi.Environment TIMESERIES AUTO SINCE {{timeWindow}}"
              }
            ]
          }
        },
        {
          "title": "API Calls by Status Code",
          "layout": {
            "column": 9,
            "row": 4,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.bar"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM Metric SELECT sum(aws.eplforecast.footballapi.APICallCount) WHERE collector.name = 'cloudwatch-metric-streams' FACET aws.eplforecast.footballapi.StatusCode, aws.eplforecast.footballapi.Environment SINCE {{timeWindow}}"
              }
            ]
          }
        },
        {
          "title": "Response Time by Environment",
          "layout": {
            "column": 1,
            "row": 7,
            "width": 12,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM Metric SELECT average(aws.eplforecast.footballapi.APIResponseTime) WHERE collector.name = 'cloudwatch-metric-streams' FACET aws.eplforecast.footballapi.Environment TIMESERIES AUTO SINCE {{timeWindow}}"
              }
            ]
          }
        },
        {
          "title": "API Call Details by Environment & Reason",
          "layout": {
            "column": 1,
            "row": 10,
            "width": 12,
            "height": 3
          },
          "visualization": {
            "id": "viz.table"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM Metric SELECT sum(aws.eplforecast.footballapi.APICallCount) AS 'Total Calls', average(aws.eplforecast.footballapi.APIResponseTime) AS 'Avg Response Time (ms)', latest(timestamp) AS 'Last Call' WHERE collector.name = 'cloudwatch-metric-streams' FACET aws.eplforecast.footballapi.Environment, aws.eplforecast.footballapi.CallReason, aws.eplforecast.footballapi.StatusCode SINCE {{timeWindow}}"
              }
            ]
          }
        },
        {
          "title": "Dev Environment - API Calls Over Time",
          "layout": {
            "column": 1,
            "row": 13,
            "width": 6,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM Metric SELECT sum(aws.eplforecast.footballapi.APICallCount) WHERE collector.name = 'cloudwatch-metric-streams' AND aws.eplforecast.footballapi.Environment = 'dev' FACET aws.eplforecast.footballapi.CallReason TIMESERIES AUTO SINCE {{timeWindow}}"
              }
            ]
          }
        },
        {
          "title": "Prod Environment - API Calls Over Time",
          "layout": {
            "column": 7,
            "row": 13,
            "width": 6,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM Metric SELECT sum(aws.eplforecast.footballapi.APICallCount) WHERE collector.name = 'cloudwatch-metric-streams' AND aws.eplforecast.footballapi.Environment = 'prod' FACET aws.eplforecast.footballapi.CallReason TIMESERIES AUTO SINCE {{timeWindow}}"
              }
            ]
          }
        },
        {
          "title": "Dev Environment - Response Time",
          "layout": {
            "column": 1,
            "row": 16,
            "width": 6,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM Metric SELECT min(aws.eplforecast.footballapi.APIResponseTime) AS 'Min', average(aws.eplforecast.footballapi.APIResponseTime) AS 'Avg', max(aws.eplforecast.footballapi.APIResponseTime) AS 'Max' WHERE collector.name = 'cloudwatch-metric-streams' AND aws.eplforecast.footballapi.Environment = 'dev' TIMESERIES AUTO SINCE {{timeWindow}}"
              }
            ]
          }
        },
        {
          "title": "Prod Environment - Response Time",
          "layout": {
            "column": 7,
            "row": 16,
            "width": 6,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM Metric SELECT min(aws.eplforecast.footballapi.APIResponseTime) AS 'Min', average(aws.eplforecast.footballapi.APIResponseTime) AS 'Avg', max(aws.eplforecast.footballapi.APIResponseTime) AS 'Max' WHERE collector.name = 'cloudwatch-metric-streams' AND aws.eplforecast.footballapi.Environment = 'prod' TIMESERIES AUTO SINCE {{timeWindow}}"
              }
            ]
          }
        }
      ]
    },
    {
      "name": "Business Metrics",
      "description": "Business logic and user-facing metrics",
      "widgets": [
        {
          "title": "Position Changes (24h)",
          "layout": {
            "column": 1,
            "row": 1,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM PositionChangesDetected SELECT sum(total_changes) AS 'Total Changes', sum(teams_affected) AS 'Teams Affected' SINCE {{timeWindow}}"
              }
            ]
          }
        },
        {
          "title": "Notifications Sent (24h)",
          "layout": {
            "column": 5,
            "row": 1,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM NotificationBatchProcessed SELECT sum(users_notified) AS 'Users Notified' SINCE {{timeWindow}}"
              }
            ]
          }
        },
        {
          "title": "Notification Success Rate",
          "layout": {
            "column": 9,
            "row": 1,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM Metric SELECT (sum(custom.notifications.sent) / (sum(custom.notifications.sent) + sum(custom.notifications.failed))) * 100 AS 'Success Rate %' SINCE {{timeWindow}}"
              }
            ],
            "thresholds": [
              {
                "alertSeverity": "CRITICAL",
                "value": 95
              },
              {
                "alertSeverity": "WARNING",
                "value": 98
              }
            ]
          }
        },
        {
          "title": "Match Window Activity",
          "layout": {
            "column": 1,
            "row": 4,
            "width": 8,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM MatchWindowEvaluation SELECT latest(window_active) AS 'Window Active', latest(active_matches) AS 'Active Matches', latest(upcoming_matches) AS 'Upcoming Matches' TIMESERIES AUTO SINCE {{timeWindow}}"
              }
            ]
          }
        },
        {
          "title": "Match Updates Success/Failure",
          "layout": {
            "column": 9,
            "row": 4,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.pie"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM Metric SELECT sum(custom.matchupdate.success) AS 'Success', sum(custom.matchupdate.failed) AS 'Failed' SINCE {{timeWindow}}"
              }
            ]
          }
        },
        {
          "title": "Position Changes Over Time",
          "layout": {
            "column": 1,
            "row": 7,
            "width": 6,
            "height": 3
          },
          "visualization": {
            "id": "viz.area"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM PositionChangesDetected SELECT sum(total_changes) AS 'Position Changes', sum(teams_affected) AS 'Teams' TIMESERIES AUTO SINCE {{timeWindow}}"
              }
            ]
          }
        },
        {
          "title": "Notification Batch Results",
          "layout": {
            "column": 7,
            "row": 7,
            "width": 6,
            "height": 3
          },
          "visualization": {
            "id": "viz.table"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM NotificationBatchProcessed SELECT timestamp, position_changes, users_notified, context SINCE {{timeWindow}} LIMIT 20"
              }
            ]
          }
        }
      ]
    },
    {
      "name": "System Performance",
      "description": "Lambda execution metrics, errors, and system health",
      "widgets": [
        {
          "title": "Lambda Invocations",
          "layout": {
            "column": 1,
            "row": 1,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM Metric SELECT sum(aws.lambda.Invocations) WHERE collector.name = 'cloudwatch-metric-streams' FACET aws.lambda.FunctionName SINCE {{timeWindow}}"
              }
            ]
          }
        },
        {
          "title": "Lambda Errors",
          "layout": {
            "column": 5,
            "row": 1,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM Metric SELECT sum(aws.lambda.Errors) AS 'Total Errors' WHERE collector.name = 'cloudwatch-metric-streams' SINCE {{timeWindow}}"
              }
            ],
            "thresholds": [
              {
                "alertSeverity": "WARNING",
                "value": 1
              },
              {
                "alertSeverity": "CRITICAL",
                "value": 5
              }
            ]
          }
        },
        {
          "title": "Lambda Error Rate %",
          "layout": {
            "column": 9,
            "row": 1,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM Metric SELECT (sum(aws.lambda.Errors) / sum(aws.lambda.Invocations)) * 100 AS 'Error Rate %' WHERE collector.name = 'cloudwatch-metric-streams' SINCE {{timeWindow}}"
              }
            ],
            "thresholds": [
              {
                "alertSeverity": "CRITICAL",
                "value": 1
              },
              {
                "alertSeverity": "WARNING",
                "value": 5
              }
            ]
          }
        },
        {
          "title": "Lambda Duration by Function",
          "layout": {
            "column": 1,
            "row": 4,
            "width": 6,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM Metric SELECT average(aws.lambda.Duration) WHERE collector.name = 'cloudwatch-metric-streams' FACET aws.lambda.FunctionName TIMESERIES AUTO SINCE {{timeWindow}}"
              }
            ]
          }
        },
        {
          "title": "Lambda Concurrent Executions",
          "layout": {
            "column": 7,
            "row": 4,
            "width": 6,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM Metric SELECT max(aws.lambda.ConcurrentExecutions) WHERE collector.name = 'cloudwatch-metric-streams' FACET aws.lambda.FunctionName TIMESERIES AUTO SINCE {{timeWindow}}"
              }
            ]
          }
        },
        {
          "title": "Lambda Throttles",
          "layout": {
            "column": 1,
            "row": 7,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM Metric SELECT sum(aws.lambda.Throttles) AS 'Total Throttles' WHERE collector.name = 'cloudwatch-metric-streams' SINCE {{timeWindow}}"
              }
            ],
            "thresholds": [
              {
                "alertSeverity": "CRITICAL",
                "value": 1
              }
            ]
          }
        },
        {
          "title": "Dead Letter Queue Depth",
          "layout": {
            "column": 5,
            "row": 7,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM Metric SELECT latest(aws.sqs.ApproximateNumberOfMessagesVisible) AS 'Messages in DLQ' WHERE collector.name = 'cloudwatch-metric-streams' AND entityName LIKE '%epl-lambda-errors%' SINCE {{timeWindow}}"
              }
            ],
            "thresholds": [
              {
                "alertSeverity": "CRITICAL",
                "value": 1
              }
            ]
          }
        },
        {
          "title": "API Gateway Requests",
          "layout": {
            "column": 9,
            "row": 7,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM Metric SELECT sum(aws.apigateway.Count) AS 'Total Requests' WHERE collector.name = 'cloudwatch-metric-streams' SINCE {{timeWindow}}"
              }
            ]
          }
        },
        {
          "title": "API Gateway 4xx/5xx Errors",
          "layout": {
            "column": 1,
            "row": 10,
            "width": 6,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM Metric SELECT sum(`aws.apigateway.4XXError`) AS '4xx Errors', sum(`aws.apigateway.5XXError`) AS '5xx Errors' WHERE collector.name = 'cloudwatch-metric-streams' TIMESERIES AUTO SINCE {{timeWindow}}"
              }
            ]
          }
        },
        {
          "title": "API Gateway Latency",
          "layout": {
            "column": 7,
            "row": 10,
            "width": 6,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM Metric SELECT average(aws.apigateway.Latency) AS 'Avg Latency', percentile(aws.apigateway.Latency, 95) AS 'p95 Latency', percentile(aws.apigateway.Latency, 99) AS 'p99 Latency' WHERE collector.name = 'cloudwatch-metric-streams' TIMESERIES AUTO SINCE {{timeWindow}}"
              }
            ]
          }
        },
        {
          "title": "DynamoDB Read/Write Operations",
          "layout": {
            "column": 1,
            "row": 13,
            "width": 6,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM Metric SELECT sum(aws.dynamodb.ConsumedReadCapacityUnits) AS 'Read Units', sum(aws.dynamodb.ConsumedWriteCapacityUnits) AS 'Write Units' WHERE collector.name = 'cloudwatch-metric-streams' TIMESERIES AUTO SINCE {{timeWindow}}"
              }
            ]
          }
        },
        {
          "title": "DynamoDB Throttled Requests",
          "layout": {
            "column": 7,
            "row": 13,
            "width": 6,
            "height": 3
          },
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM Metric SELECT sum(aws.dynamodb.UserErrors) AS 'User Errors', sum(aws.dynamodb.SystemErrors) AS 'System Errors' WHERE collector.name = 'cloudwatch-metric-streams' SINCE {{timeWindow}}"
              }
            ],
            "thresholds": [
              {
                "alertSeverity": "CRITICAL",
                "value": 1
              }
            ]
          }
        },
        {
          "title": "Lambda Invocations by Function Over Time",
          "layout": {
            "column": 1,
            "row": 16,
            "width": 12,
            "height": 3
          },
          "visualization": {
            "id": "viz.area"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 7052187,
                "query": "FROM Metric SELECT sum(aws.lambda.Invocations) WHERE collector.name = 'cloudwatch-metric-streams' FACET aws.lambda.FunctionName TIMESERIES AUTO SINCE {{timeWindow}}"
              }
            ]
          }
        }
      ]
    }
  ]
}
